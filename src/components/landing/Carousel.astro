---
// Import the JSON file for Carousel
import carouselData from '../../data/carouselData.json';
---

<section class="carousel-section service-carousel relative w-full overflow-hidden py-4">
  <div class="mx-auto max-w-7xl">
    <div class="relative">
      <div class="pointer-events-none absolute inset-0 z-10 flex w-full justify-between">
        <div class="w-44 bg-gradient-to-r from-[#1e1e1e] via-transparent to-transparent"></div>
        <div class="w-44 bg-gradient-to-l from-[#1e1e1e] via-transparent to-transparent"></div>
      </div>

      <!-- Carousel Container -->
      <div class="carousel-marquee-container scrollbar-hide">
        <div class="carousel-image-marquee gap-5" id="carousel-loop">
          {carouselData.images.map((item, index) => (
            <div class="carousel-item" key={index}>
              <img
                src={item.src}
                alt={item.alt}
                class="carousel-image"
              />
              <span class="carousel-text">{item.alt}</span>
            </div>
          ))}

          {carouselData.images.map((item, index) => (
            <div class="carousel-item" key={`duplicate-${index}`}>
              <img
                src={item.src}
                alt={`${item.alt} Duplicate`}
                class="carousel-image"
              />
              <span class="carousel-text">{item.alt}</span>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const marqueeContainer = document.querySelector('.carousel-marquee-container');
    const marqueeAnimation = document.querySelector('#carousel-loop');
    if (!marqueeContainer || !marqueeAnimation) return;

    // Enable smooth scrolling
    marqueeContainer.style.overflowX = 'scroll';
    marqueeContainer.style.scrollBehavior = 'smooth';

    // Looping logic for infinite scrolling
    const scrollWidth = marqueeAnimation.scrollWidth / 2;

    const checkScroll = () => {
      if (marqueeContainer.scrollLeft >= scrollWidth) {
        marqueeContainer.scrollLeft = 0;
      } else if (marqueeContainer.scrollLeft === 0) {
        marqueeContainer.scrollLeft = scrollWidth;
      }
    };

    marqueeContainer.addEventListener('scroll', checkScroll);

    // Auto-scroll functionality
    let autoScrollInterval = setInterval(() => {
      marqueeContainer.scrollBy({ left: 1, behavior: 'smooth' });
    }, 20);

    // Pause auto-scroll on hover or drag
    marqueeContainer.addEventListener('mouseenter', () => clearInterval(autoScrollInterval));
    marqueeContainer.addEventListener('mouseleave', () => {
      autoScrollInterval = setInterval(() => {
        marqueeContainer.scrollBy({ left: 1, behavior: 'smooth' });
      }, 20);
    });

    // Drag functionality
    let isDragging = false;
    let startX = 0;
    let scrollLeft = 0;

    const startDrag = (e) => {
      isDragging = true;
      startX = e.pageX || (e.touches?.[0]?.pageX ?? 0);
      scrollLeft = marqueeContainer.scrollLeft;
      clearInterval(autoScrollInterval); // Pause auto-scroll while dragging
    };

    const onDrag = (e) => {
      if (!isDragging) return;
      const currentX = e.pageX || (e.touches?.[0]?.pageX ?? 0);
      const x = currentX - startX;
      marqueeContainer.scrollLeft = scrollLeft - x;
    };

    const stopDrag = () => {
      if (isDragging) {
        isDragging = false;
        // Restart auto-scroll after dragging
        autoScrollInterval = setInterval(() => {
          marqueeContainer.scrollBy({ left: 1, behavior: 'smooth' });
        }, 20);
      }
    };

    marqueeContainer.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', onDrag);
    document.addEventListener('mouseup', stopDrag);

    marqueeContainer.addEventListener('touchstart', startDrag);
    document.addEventListener('touchmove', onDrag);
    document.addEventListener('touchend', stopDrag);
  });
</script>
