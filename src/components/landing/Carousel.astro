---
// Carousel.astro
---

<section class="image-carousel relative w-full overflow-hidden">
  <div class="mx-auto max-w-[100vw]"> <!-- Added max-width constraint -->
    <div class="relative py-2">
      <!-- Gradient Overlays -->
      <div class="pointer-events-none absolute inset-0 z-10 flex w-full justify-between">
        <div class="w-44 bg-gradient-to-r from-black via-transparent to-transparent"></div>
        <div class="w-44 bg-gradient-to-l from-black via-transparent to-transparent"></div>
      </div>

      <!-- Marquee Container -->
      <div class="marquee-container overflow-x-auto scrollbar-hide">
        <div class="flex items-center image-marquee-animation gap-4 whitespace-nowrap">
          {/* Original Images */}
          {[1, 2, 3, 4, 5].map((num) => (
            <img
              src={`/images/image${num}.jpg`}
              alt={`Image ${num}`}
              class="h-[72px] w-[232px] rounded-full"
            />
          ))}
          {/* First Duplicate Set */}
          {[1, 2, 3, 4, 5].map((num) => (
            <img
              src={`/images/image${num}.jpg`}
              alt={`Image ${num}`}
              class="h-[72px] w-[232px] rounded-full"
            />
          ))}
          {/* Second Duplicate Set */}
          {[1, 2, 3, 4, 5].map((num) => (
            <img
              src={`/images/image${num}.jpg`}
              alt={`Image ${num}`}
              class="h-[72px] w-[232px] rounded-full"
            />
          ))}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Hide scrollbar */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  /* Marquee Animation */
  @keyframes marquee {
    0% {
      transform: translateX(0%);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  .image-marquee-animation {
    animation: marquee 30s linear infinite;
  }

  .marquee-container:hover .image-marquee-animation {
    animation-play-state: paused;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const marqueeContainer = document.querySelector('.marquee-container');
    const marqueeAnimation = document.querySelector('.image-marquee-animation');

    if (marqueeContainer && marqueeAnimation) {
      let isDragging = false;
      let startX: number, scrollLeft: number;

      const startDrag = (e: MouseEvent | TouchEvent) => {
        isDragging = true;
        marqueeAnimation.style.animationPlayState = 'paused';
        startX = e instanceof MouseEvent ? e.pageX : e.touches[0].pageX;
        scrollLeft = marqueeContainer.scrollLeft;
      };

      const onDrag = (e: MouseEvent | TouchEvent) => {
        if (!isDragging) return;
        const x = (e instanceof MouseEvent ? e.pageX : e.touches[0].pageX) - startX;
        marqueeContainer.scrollLeft = scrollLeft - x;
      };

      const stopDrag = () => {
        if (isDragging) {
          isDragging = false;
          marqueeAnimation.style.animationPlayState = 'running';
        }
      };

      // Mouse events
      marqueeContainer.addEventListener('mousedown', startDrag);
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', stopDrag);

      // Touch events
      marqueeContainer.addEventListener('touchstart', startDrag);
      document.addEventListener('touchmove', onDrag);
      document.addEventListener('touchend', stopDrag);
    }
  });
</script>